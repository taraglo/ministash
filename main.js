const{app:app,BrowserWindow:BrowserWindow,ipcMain:ipcMain,dialog:dialog,Menu:Menu,shell:shell}=require("electron"),fs=require("fs"),path=require("path"),Store=require("electron-store"),store=new Store,os=require("os");let mainWindow;function createWindow(){let e="default",n={};"darwin"===os.platform()?(e="hidden",n={x:15,y:13}):"win32"===os.platform()&&(e="hiddenInset"),mainWindow=new BrowserWindow({width:1280,height:1080,minWidth:1e3,minHeight:800,webPreferences:{nodeIntegration:!0,contextIsolation:!1,preload:path.join(__dirname,"preload.js")},icon:path.join(app.getAppPath(),"assets/logo/logo_transparent.png"),title:"MiniStash",titleBarStyle:e,trafficLightPosition:n}),mainWindow.loadFile("index.html"),mainWindow.webContents.setWindowOpenHandler((({url:e})=>(shell.openExternal(e),{action:"deny"}))),store.get("firstLaunch")||(mainWindow.webContents.send("clear-localstorage"),dialog.showOpenDialog(mainWindow,{properties:["openDirectory"]}).then((e=>{e.canceled||mainWindow.webContents.send("selected-directory",e.filePaths[0])})).catch((e=>{console.log(e)})),store.set("firstLaunch",!0))}function createMenu(){const e=Menu.buildFromTemplate([{label:"MiniStash",submenu:[{label:"About",accelerator:"darwin"===process.platform?"Cmd+I":"Alt+Shift+I",click(){dialog.showMessageBox({title:"MiniStash Version 1.0.0",message:"MiniStash is a mini video gallery for your local video files. Built by taraglo on GitHub",icon:path.join(__dirname,"/assets/logo/logo.png")})}},{label:"Exit",accelerator:"darwin"===process.platform?"Cmd+Q":"Alt+F4",click(){mainWindow.webContents.send("clear-localstorage"),app.quit()}}]},{label:"File",submenu:[{label:"Open Folder",accelerator:"darwin"===process.platform?"Cmd+O":"Ctrl+O",click(){dialog.showOpenDialog({properties:["openDirectory"]}).then((e=>{e.canceled||mainWindow.webContents.send("selected-directory",e.filePaths[0])})).catch((e=>{console.log(e)}))}}]}]);Menu.setApplicationMenu(e)}app.whenReady().then((()=>{createWindow(),createMenu()})),app.on("before-quit",(()=>{mainWindow.webContents.send("clear-localstorage")})),app.on("window-all-closed",(function(){app.quit()})),app.on("activate",(function(){0===BrowserWindow.getAllWindows().length&&createWindow()})),ipcMain.on("get-files",((e,n)=>{fs.readdir(n,((o,i)=>{if(o)return void console.log(o);const t=i.map((e=>({name:e,path:path.join(n,e)})));e.sender.send("get-files-response",t)}))})),ipcMain.on("open-folder",(e=>{dialog.showOpenDialog({properties:["openDirectory"]}).then((n=>{n.canceled?e.sender.send("selected-directory",""):e.sender.send("selected-directory",n.filePaths[0])})).catch((e=>{console.log(e)}))})),ipcMain.on("clear-localstorage",(()=>{mainWindow.webContents.localStorage.setItem("folder","")}));